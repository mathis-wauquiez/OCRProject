<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="3951px" preserveAspectRatio="none" style="width:3258px;height:3951px;" version="1.1" viewBox="0 0 3258 3951" width="3258px" zoomAndPan="magnify"><defs/><g><text fill="#000000" font-family="sans-serif" font-size="16" lengthAdjust="spacingAndGlyphs" textLength="468" x="1394.25" y="24.8516">A Contrario Character Clustering — Pipeline Activity Diagram</text><rect fill="#E8F5E9" height="3764.7905" style="stroke: #E8F5E9; stroke-width: 1.0;" width="333" x="10" y="29.7192"/><ellipse cx="177" cy="57.5239" fill="#000000" rx="10" ry="10" style="stroke: none; stroke-width: 1.0;"/><rect fill="#FEFECE" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="190" x="82" y="87.5239"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="170" x="92" y="108.6626">Load document image (PIL)</text><rect fill="#FEFECE" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="219" x="67.5" y="141.4927"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="199" x="77.5" y="162.6313">CRAFT neural network inference</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="145" x="77.5" y="176.6001">(score_text, score_link)</text><rect fill="#FEFECE" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="269" x="42.5" y="209.4302"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="249" x="52.5" y="230.5688">Watershed segmentation on score map</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="192" x="52.5" y="244.5376">(dual-threshold: seed + basin)</text><rect fill="#FEFECE" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="175" x="89.5" y="277.3677"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="155" x="99.5" y="298.5063">Filter CRAFT components</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="123" x="99.5" y="312.4751">(area, aspect ratio)</text><rect fill="#FEFECE" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="230" x="62" y="345.3052"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="210" x="72" y="366.4438">Merge nearby CRAFT components</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="129" x="72" y="380.4126">(link score proximity)</text><rect fill="#FEFECE" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="146" x="104" y="413.2427"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="126" x="114" y="434.3813">Binarize page image</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="120" x="114" y="448.3501">(Otsu / Li / triangle)</text><rect fill="#FEFECE" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="259" x="47.5" y="481.1802"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="239" x="57.5" y="502.3188">Extract image connected components</text><rect fill="#FEFECE" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="230" x="62" y="535.1489"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="210" x="72" y="556.2876">Filter by aspect ratio &amp; major axis</text><rect fill="#FEFECE" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="250" x="52" y="589.1177"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="197" x="62" y="610.2563">Compute Mahalanobis similarity</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="230" x="62" y="624.2251">(CRAFT centroids ↔ image centroids)</text><rect fill="#FEFECE" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="238" x="58" y="657.0552"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="218" x="68" y="678.1938">Hungarian matching: assign image</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="208" x="68" y="692.1626">components to CRAFT detections</text><rect fill="#FEFECE" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="229" x="62.5" y="724.9927"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="165" x="72.5" y="746.1313">Filter by contour proximity,</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="209" x="72.5" y="760.1001">aspect ratio, filled area, min area</text><rect fill="#FEFECE" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="251" x="51.5" y="792.9302"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="231" x="61.5" y="814.0688">Save connectedComponent .npz files</text><rect fill="#E3F2FD" height="3764.7905" style="stroke: #E3F2FD; stroke-width: 1.0;" width="664" x="343" y="29.7192"/><rect fill="#FEFECE" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="254" x="548.5" y="846.8989"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="234" x="558.5" y="868.0376">Load connectedComponent from .npz</text><rect fill="#000000" height="6" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 1.0;" width="645" x="353" y="900.8677"/><rect fill="#FEFECE" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="86" x="467.5" y="926.8677"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="66" x="477.5" y="948.0063">CPU Stage</text><rect fill="#FEFECE" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="239" x="391" y="995.8364"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="219" x="401" y="1016.9751">Extract binary &amp; grayscale patches</text><rect fill="#FEFECE" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="249" x="386" y="1064.8052"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="229" x="396" y="1085.9438">Apply ink filter (background removal)</text><rect fill="#FEFECE" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="271" x="375" y="1125.7583"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="197" x="385" y="1146.897">Vectorize binary patches → SVG</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="251" x="385" y="1160.8657">(external C++ → BinaryShapeVectorizer)</text><rect fill="#FEFECE" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="291" x="365" y="1208.6958"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="271" x="375" y="1229.8345">Deskew SVGs (page orientation → rotation)</text><rect fill="#FEFECE" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="791.5" y="974.8833"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="67" x="801.5" y="996.022">GPU Stage</text><rect fill="#FEFECE" height="61.9063" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="297" x="686.5" y="1043.8521"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="158" x="696.5" y="1064.9907">CHAT OCR per subcolumn</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="277" x="696.5" y="1078.9595">(Kraken rpred → spatial Hungarian matching</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="154" x="700.5" y="1092.9282">→ char_chat / conf_chat)</text><rect fill="#FEFECE" height="61.9063" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="302" x="684" y="1132.7427"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="162" x="694" y="1153.8813">Compute HOG descriptors</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="282" x="694" y="1167.8501">(Renderer → DataLoader → HOG convolutions</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="205" x="698" y="1181.8188">→ trilinear binning → histograms)</text><rect fill="#000000" height="6" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 1.0;" width="645" x="353" y="1262.6646"/><rect fill="#FEFECE" height="61.9063" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="259" x="546" y="1288.6646"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="129" x="556" y="1309.8032">Produce DataFrame:</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="160" x="564" y="1323.772">page, file, label, centroid,</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="231" x="564" y="1337.7407">svg, histogram, char_chat, conf_chat</text><rect fill="#FFF3E0" height="3764.7905" style="stroke: #FFF3E0; stroke-width: 1.0;" width="688" x="1007" y="29.7192"/><rect fill="#FFFFFF" height="767.3784" style="stroke: #000000; stroke-width: 2.0;" width="396" x="1290" y="1360.665"/><path d="M1430,1361.665 L1430,1366.4697 L1420,1376.4697 L1290,1376.4697 " fill="none" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="130" x="1293" y="1371.8755">3a. HOG Config Sweep</text><rect fill="#FEFECE" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="356" x="1320" y="1393.4697"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="143" x="1330" y="1414.6084">Generate HOG configs:</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="336" x="1330" y="1428.5771">cell_sizes × grdt_sigmas × num_bins × normalizations</text><rect fill="#FEFECE" height="61.9063" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="216" x="1390" y="1517.1177"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="196" x="1400" y="1538.2563">Instantiate Renderer(svg_imgs)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="178" x="1400" y="1552.2251">→ DataLoader → HOG(batch)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="134" x="1400" y="1566.1938">→ histogram features</text><rect fill="#FEFECE" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="290" x="1353" y="1599.0239"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="270" x="1363" y="1620.1626">featureMatching.match(features, features)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="215" x="1363" y="1634.1313">→ NLFA matrix, dissimilarities, μ, σ²</text><rect fill="#FFFFFF" height="383.019" style="stroke: #000000; stroke-width: 2.0;" width="324" x="1324" y="1657.0557"/><path d="M1457,1658.0557 L1457,1662.8604 L1447,1672.8604 L1324,1672.8604 " fill="none" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="123" x="1327" y="1668.2661">3b. ε × γ Grid Search</text><rect fill="#FEFECE" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="213" x="1391.5" y="1745.5708"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="157" x="1401.5" y="1766.7095">Build NX graph from NLFA</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="193" x="1401.5" y="1780.6782">(threshold + reciprocal edges)</text><rect fill="#FEFECE" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="223" x="1386.5" y="1880.0552"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="98" x="1396.5" y="1901.1938">Leiden partition</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="203" x="1396.5" y="1915.1626">(RBConfigurationVertexPartition)</text><rect fill="#FEFECE" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="232" x="1382" y="1950.106"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="212" x="1392" y="1971.2446">Evaluate ARI against ground truth</text><polygon fill="#FEFECE" points="1469.5,1819.2505,1526.5,1819.2505,1538.5,1831.2505,1526.5,1843.2505,1469.5,1843.2505,1457.5,1831.2505,1469.5,1819.2505" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="34" x="1502" y="1853.4609">next γ</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="57" x="1469.5" y="1835.0586">for each γ</text><polygon fill="#FEFECE" points="1469.5,1689.8604,1526.5,1689.8604,1538.5,1701.8604,1526.5,1713.8604,1469.5,1713.8604,1457.5,1701.8604,1469.5,1689.8604" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="34" x="1502" y="1724.0708">next ε</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="57" x="1469.5" y="1705.6685">for each ε</text><rect fill="#FEFECE" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="195" x="1400.5" y="2060.0747"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="175" x="1410.5" y="2081.2134">Track best (config, ε, γ, ARI)</text><polygon fill="#FEFECE" points="1440.5,1461.4072,1555.5,1461.4072,1567.5,1473.4072,1555.5,1485.4072,1440.5,1485.4072,1428.5,1473.4072,1440.5,1461.4072" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="62" x="1502" y="1495.6177">next config</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="115" x="1440.5" y="1477.2153">for each HOG config</text><rect fill="#FEFECE" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="209" x="1393.5" y="2148.0435"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="189" x="1403.5" y="2169.1821">Select best overall HOG config</text><rect fill="#FFFFFF" height="1424.5283" style="stroke: #000000; stroke-width: 2.0;" width="642" x="1017" y="2192.1064"/><path d="M1197,2193.1064 L1197,2197.9111 L1187,2207.9111 L1017,2207.9111 " fill="none" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="170" x="1020" y="2203.3169">3c. report_graph (best config)</text><rect fill="#FEFECE" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="237" x="1379.5" y="2224.9111"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="217" x="1389.5" y="2246.0498">Build final graph + Leiden partition</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="93" x="1389.5" y="2260.0186">with best (ε, γ)</text><rect fill="#FEFECE" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="187" x="1404.5" y="2292.8486"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="167" x="1414.5" y="2313.9873">Compute degree centrality</text><rect fill="#FFEBEE" height="3764.7905" style="stroke: #FFEBEE; stroke-width: 1.0;" width="661" x="1695" y="29.7192"/><rect fill="#FFFFFF" height="1424.5283" style="stroke: #000000; stroke-width: 2.0;" width="642" x="1705" y="2192.1064"/><path d="M1885,2193.1064 L1885,2197.9111 L1875,2207.9111 L1705,2207.9111 " fill="none" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="170" x="1708" y="2203.3169">3c. report_graph (best config)</text><rect fill="#FFFFFF" height="368.3047" style="stroke: #000000; stroke-width: 2.0;" width="622" x="1715" y="2336.9116"/><path d="M1923,2337.9116 L1923,2342.7163 L1913,2352.7163 L1715,2352.7163 " fill="none" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="198" x="1718" y="2348.1221">4a. Composable Refinement Steps</text><path d="M1735,2500.8569 L1735,2562.0757 L2035,2562.0757 L2035,2510.8569 L2025,2500.8569 L1735,2500.8569 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M2025,2500.8569 L2025,2510.8569 L2035,2510.8569 L2025,2500.8569 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="240" x="1741" y="2516.0674">Each step: run(df, membership, renderer,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="114" x="1801" y="2528.8721">target_lbl=..., **ctx)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="279" x="1741" y="2541.6768">→ RefinementResult(membership, log, metadata)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="135" x="1741" y="2554.4814">Output feeds next step.</text><rect fill="#FEFECE" height="103.8125" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="282" x="2045" y="2369.7163"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="132" x="2055" y="2390.855">① HausdorffSplitStep</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="196" x="2055" y="2404.8237">── Per-cluster IC registration ──</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="217" x="2055" y="2418.7925">── Pairwise Hausdorff distances ──</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="224" x="2055" y="2432.7612">── Hierarchical linkage + fcluster ──</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="247" x="2055" y="2446.73">── Sweep split thresholds → best ARI ──</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="262" x="2055" y="2460.6987">── Unknown patches → largest subcluster</text><rect fill="#FEFECE" height="75.875" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="272" x="2050" y="2493.5288"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="124" x="2060" y="2514.6675">② OCRRematchStep</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="205" x="2060" y="2528.6362">── Small clusters (≤ max_size) ──</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="200" x="2060" y="2542.605">── Match dominant OCR label ──</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="252" x="2060" y="2556.5737">── Merge into largest same-label cluster</text><rect fill="#FEFECE" height="103.8125" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="252" x="2060" y="2589.4038"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="168" x="2070" y="2610.5425">③ PCAZScoreRematchStep</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="191" x="2070" y="2624.5112">── Remaining small clusters ──</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="227" x="2070" y="2638.48">── k-NN candidates by mean HOG ──</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="232" x="2070" y="2652.4487">── Register query → target anchor ──</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="218" x="2070" y="2666.4175">── PCA projection + z-score test ──</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="164" x="2070" y="2680.3862">── Merge if max|z| &lt; z_max</text><rect fill="#FFFFFF" height="244.4922" style="stroke: #000000; stroke-width: 2.0;" width="274" x="2049" y="2715.3105"/><path d="M2225,2716.3105 L2225,2721.1152 L2215,2731.1152 L2049,2731.1152 " fill="none" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="166" x="2052" y="2726.521">4b. New Refinement Methods</text><rect fill="#FEFECE" height="89.8438" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="236" x="2068" y="2748.1152"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="205" x="2078" y="2769.2539">④ MRFRefinementStep (optional)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="216" x="2078" y="2783.2227">── Unary: OCR probability matrix ──</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="192" x="2078" y="2797.1914">── Pairwise: β · NLFA (Potts) ──</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="147" x="2078" y="2811.1602">── Max-sum loopy BP ──</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="155" x="2078" y="2825.1289">── Damped convergence</text><rect fill="#FEFECE" height="89.8438" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="254" x="2059" y="2857.959"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="234" x="2069" y="2879.0977">⑤ KMedoidsSplitMergeStep (optional)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="213" x="2069" y="2893.0664">── Reassign to nearest medoid ──</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="217" x="2069" y="2907.0352">── Spectral split (Fiedler vector) ──</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="165" x="2069" y="2921.0039">── NFA-validated merge ──</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="134" x="2069" y="2934.9727">── Iterate until stable</text><rect fill="#FFF3E0" height="3764.7905" style="stroke: #FFF3E0; stroke-width: 1.0;" width="583.5" x="2356" y="29.7192"/><rect fill="#FFFFFF" height="1424.5283" style="stroke: #000000; stroke-width: 2.0;" width="564.5" x="2366" y="2192.1064"/><path d="M2546,2193.1064 L2546,2197.9111 L2536,2207.9111 L2366,2207.9111 " fill="none" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="170" x="2369" y="2203.3169">3c. report_graph (best config)</text><rect fill="#FEFECE" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="236" x="2668.5" y="3028.2051"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="116" x="2678.5" y="3049.3438">chat_split_clusters</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="216" x="2678.5" y="3063.3125">Split impure clusters by CHAT label</text><polygon fill="#FEFECE" points="2734.5,2979.8027,2838.5,2979.8027,2850.5,2991.8027,2838.5,3003.8027,2734.5,3003.8027,2722.5,2991.8027,2734.5,2979.8027" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="20" x="2790.5" y="3014.0132">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="104" x="2734.5" y="2995.6108">enable_chat_split?</text><polygon fill="#FEFECE" points="2786.5,3096.1426,2798.5,3108.1426,2786.5,3120.1426,2774.5,3108.1426,2786.5,3096.1426" style="stroke: #A80036; stroke-width: 1.5;"/><rect fill="#FEFECE" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="222" x="2675.5" y="3188.5449"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="105" x="2685.5" y="3209.6836">associate_hapax</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="202" x="2685.5" y="3223.6523">Merge singletons by dissimilarity</text><polygon fill="#FEFECE" points="2709,3140.1426,2864,3140.1426,2876,3152.1426,2864,3164.1426,2709,3164.1426,2697,3152.1426,2709,3140.1426" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="20" x="2790.5" y="3174.353">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="155" x="2709" y="3155.9507">enable_hapax_association?</text><polygon fill="#FEFECE" points="2786.5,3256.4824,2798.5,3268.4824,2786.5,3280.4824,2774.5,3268.4824,2786.5,3256.4824" style="stroke: #A80036; stroke-width: 1.5;"/><rect fill="#FEFECE" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="227" x="2673" y="3348.8848"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="88" x="2683" y="3370.0234">build_glossary</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="207" x="2683" y="3383.9922">Character inventory by frequency</text><polygon fill="#FEFECE" points="2737,3300.4824,2836,3300.4824,2848,3312.4824,2836,3324.4824,2737,3324.4824,2725,3312.4824,2737,3300.4824" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="20" x="2790.5" y="3334.6929">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="99" x="2737" y="3316.2905">enable_glossary?</text><polygon fill="#FEFECE" points="2786.5,3416.8223,2798.5,3428.8223,2786.5,3440.8223,2774.5,3428.8223,2786.5,3416.8223" style="stroke: #A80036; stroke-width: 1.5;"/><rect fill="#FEFECE" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="215" x="2679" y="3460.8223"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="195" x="2689" y="3481.9609">Compute purity, completeness,</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="185" x="2689" y="3495.9297">cluster entropy, label entropy</text><rect fill="#FEFECE" height="75.875" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="223" x="2675" y="3528.7598"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="140" x="2685" y="3549.8984">Compute final metrics:</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="185" x="2685" y="3563.8672">ARI, NMI, AMI, FMI, V-measure,</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="181" x="2685" y="3577.8359">homogeneity, completeness,</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="203" x="2685" y="3591.8047">pairwise F1, Hungarian accuracy</text><rect fill="#FFF9C4" height="3764.7905" style="stroke: #FFF9C4; stroke-width: 1.0;" width="307" x="2939.5" y="29.7192"/><rect fill="#FEFECE" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="278" x="2954.5" y="3636.6348"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="138" x="2964.5" y="3657.7734">Generate HTML report</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="258" x="2964.5" y="3671.7422">(ClusteringSweepReporter → AutoReport)</text><rect fill="#FEFECE" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="288" x="2949.5" y="3704.5723"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="194" x="2959.5" y="3725.7109">Return: (dataframe, filtered_df,</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="228" x="2999.5" y="3739.6797">representatives_df, graph, partition)</text><ellipse cx="3093.5" cy="3783.5098" fill="#FFFFFF" rx="11" ry="11" style="stroke: #000000; stroke-width: 1.0;"/><ellipse cx="3093.5" cy="3783.5098" fill="#000000" rx="6" ry="6" style="stroke: #7F7F7F; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="177" x2="177" y1="67.5239" y2="87.5239"/><polygon fill="#A80036" points="173,77.5239,177,87.5239,181,77.5239,177,81.5239" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="177" x2="177" y1="121.4927" y2="141.4927"/><polygon fill="#A80036" points="173,131.4927,177,141.4927,181,131.4927,177,135.4927" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="177" x2="177" y1="189.4302" y2="209.4302"/><polygon fill="#A80036" points="173,199.4302,177,209.4302,181,199.4302,177,203.4302" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="177" x2="177" y1="257.3677" y2="277.3677"/><polygon fill="#A80036" points="173,267.3677,177,277.3677,181,267.3677,177,271.3677" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="177" x2="177" y1="325.3052" y2="345.3052"/><polygon fill="#A80036" points="173,335.3052,177,345.3052,181,335.3052,177,339.3052" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="177" x2="177" y1="393.2427" y2="413.2427"/><polygon fill="#A80036" points="173,403.2427,177,413.2427,181,403.2427,177,407.2427" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="177" x2="177" y1="461.1802" y2="481.1802"/><polygon fill="#A80036" points="173,471.1802,177,481.1802,181,471.1802,177,475.1802" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="177" x2="177" y1="515.1489" y2="535.1489"/><polygon fill="#A80036" points="173,525.1489,177,535.1489,181,525.1489,177,529.1489" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="177" x2="177" y1="569.1177" y2="589.1177"/><polygon fill="#A80036" points="173,579.1177,177,589.1177,181,579.1177,177,583.1177" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="177" x2="177" y1="637.0552" y2="657.0552"/><polygon fill="#A80036" points="173,647.0552,177,657.0552,181,647.0552,177,651.0552" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="177" x2="177" y1="704.9927" y2="724.9927"/><polygon fill="#A80036" points="173,714.9927,177,724.9927,181,714.9927,177,718.9927" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="177" x2="177" y1="772.9302" y2="792.9302"/><polygon fill="#A80036" points="173,782.9302,177,792.9302,181,782.9302,177,786.9302" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="510.5" x2="510.5" y1="960.8364" y2="995.8364"/><polygon fill="#A80036" points="506.5,985.8364,510.5,995.8364,514.5,985.8364,510.5,989.8364" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="510.5" x2="510.5" y1="1029.8052" y2="1064.8052"/><polygon fill="#A80036" points="506.5,1054.8052,510.5,1064.8052,514.5,1054.8052,510.5,1058.8052" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="510.5" x2="510.5" y1="1098.7739" y2="1125.7583"/><polygon fill="#A80036" points="506.5,1115.7583,510.5,1125.7583,514.5,1115.7583,510.5,1119.7583" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="510.5" x2="510.5" y1="1173.6958" y2="1208.6958"/><polygon fill="#A80036" points="506.5,1198.6958,510.5,1208.6958,514.5,1198.6958,510.5,1202.6958" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="835" x2="835" y1="1008.8521" y2="1043.8521"/><polygon fill="#A80036" points="831,1033.8521,835,1043.8521,839,1033.8521,835,1037.8521" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="835" x2="835" y1="1105.7583" y2="1132.7427"/><polygon fill="#A80036" points="831,1122.7427,835,1132.7427,839,1122.7427,835,1126.7427" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="510.5" x2="510.5" y1="906.8677" y2="926.8677"/><polygon fill="#A80036" points="506.5,916.8677,510.5,926.8677,514.5,916.8677,510.5,920.8677" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="835" x2="835" y1="906.8677" y2="974.8833"/><polygon fill="#A80036" points="831,964.8833,835,974.8833,839,964.8833,835,968.8833" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="510.5" x2="510.5" y1="1242.6646" y2="1262.6646"/><polygon fill="#A80036" points="506.5,1252.6646,510.5,1262.6646,514.5,1252.6646,510.5,1256.6646" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="835" x2="835" y1="1194.6489" y2="1262.6646"/><polygon fill="#A80036" points="831,1252.6646,835,1262.6646,839,1252.6646,835,1256.6646" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="675.5" x2="675.5" y1="880.8677" y2="900.8677"/><polygon fill="#A80036" points="671.5,890.8677,675.5,900.8677,679.5,890.8677,675.5,894.8677" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="675.5" x2="675.5" y1="1268.6646" y2="1288.6646"/><polygon fill="#A80036" points="671.5,1278.6646,675.5,1288.6646,679.5,1278.6646,675.5,1282.6646" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1498" x2="1498" y1="1579.0239" y2="1599.0239"/><polygon fill="#A80036" points="1494,1589.0239,1498,1599.0239,1502,1589.0239,1498,1593.0239" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1498" x2="1498" y1="1927.9927" y2="1950.106"/><polygon fill="#A80036" points="1494,1940.106,1498,1950.106,1502,1940.106,1498,1944.106" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1498" x2="1498" y1="1843.2505" y2="1880.0552"/><polygon fill="#A80036" points="1494,1870.0552,1498,1880.0552,1502,1870.0552,1498,1874.0552" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1498" x2="1498" y1="1984.0747" y2="1994.0747"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1498" x2="1626" y1="1994.0747" y2="1994.0747"/><polygon fill="#A80036" points="1622,1930.106,1626,1920.106,1630,1930.106,1626,1926.106" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1626" x2="1626" y1="1831.2505" y2="1994.0747"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1626" x2="1538.5" y1="1831.2505" y2="1831.2505"/><polygon fill="#A80036" points="1548.5,1827.2505,1538.5,1831.2505,1548.5,1835.2505,1544.5,1831.2505" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1457.5" x2="1370" y1="1831.2505" y2="1831.2505"/><polygon fill="#A80036" points="1366,1916.106,1370,1926.106,1374,1916.106,1370,1920.106" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1370" x2="1370" y1="1831.2505" y2="2006.0747"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1370" x2="1638" y1="2006.0747" y2="2006.0747"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1638" x2="1638" y1="1701.8604" y2="2006.0747"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1638" x2="1538.5" y1="1701.8604" y2="1701.8604"/><polygon fill="#A80036" points="1548.5,1697.8604,1538.5,1701.8604,1548.5,1705.8604,1544.5,1701.8604" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1498" x2="1498" y1="1793.5083" y2="1819.2505"/><polygon fill="#A80036" points="1494,1809.2505,1498,1819.2505,1502,1809.2505,1498,1813.2505" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1498" x2="1498" y1="1713.8604" y2="1745.5708"/><polygon fill="#A80036" points="1494,1735.5708,1498,1745.5708,1502,1735.5708,1498,1739.5708" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1457.5" x2="1346" y1="1701.8604" y2="1701.8604"/><polygon fill="#A80036" points="1342,1856.2349,1346,1866.2349,1350,1856.2349,1346,1860.2349" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1346" x2="1346" y1="1701.8604" y2="2028.0747"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1346" x2="1498" y1="2028.0747" y2="2028.0747"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1498" x2="1498" y1="2028.0747" y2="2060.0747"/><polygon fill="#A80036" points="1494,2050.0747,1498,2060.0747,1502,2050.0747,1498,2054.0747" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1498" x2="1498" y1="1646.9614" y2="1689.8604"/><polygon fill="#A80036" points="1494,1679.8604,1498,1689.8604,1502,1679.8604,1498,1683.8604" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1498" x2="1498" y1="1485.4072" y2="1517.1177"/><polygon fill="#A80036" points="1494,1507.1177,1498,1517.1177,1502,1507.1177,1498,1511.1177" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1498" x2="1498" y1="2094.0435" y2="2104.0435"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1498" x2="1660" y1="2104.0435" y2="2104.0435"/><polygon fill="#A80036" points="1656,1799.2505,1660,1789.2505,1664,1799.2505,1660,1795.2505" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1660" x2="1660" y1="1473.4072" y2="2104.0435"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1660" x2="1567.5" y1="1473.4072" y2="1473.4072"/><polygon fill="#A80036" points="1577.5,1469.4072,1567.5,1473.4072,1577.5,1477.4072,1573.5,1473.4072" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1428.5" x2="1312" y1="1473.4072" y2="1473.4072"/><polygon fill="#A80036" points="1308,1785.2505,1312,1795.2505,1316,1785.2505,1312,1789.2505" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1312" x2="1312" y1="1473.4072" y2="2116.0435"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1312" x2="1498" y1="2116.0435" y2="2116.0435"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1498" x2="1498" y1="2116.0435" y2="2148.0435"/><polygon fill="#A80036" points="1494,2138.0435,1498,2148.0435,1502,2138.0435,1498,2142.0435" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1498" x2="1498" y1="1441.4072" y2="1461.4072"/><polygon fill="#A80036" points="1494,1451.4072,1498,1461.4072,1502,1451.4072,1498,1455.4072" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1498" x2="1498" y1="2272.8486" y2="2292.8486"/><polygon fill="#A80036" points="1494,2282.8486,1498,2292.8486,1502,2282.8486,1498,2286.8486" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1498" x2="1498" y1="2182.0122" y2="2224.9111"/><polygon fill="#A80036" points="1494,2214.9111,1498,2224.9111,1502,2214.9111,1498,2218.9111" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2186" x2="2186" y1="2473.5288" y2="2493.5288"/><polygon fill="#A80036" points="2182,2483.5288,2186,2493.5288,2190,2483.5288,2186,2487.5288" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2186" x2="2186" y1="2569.4038" y2="2589.4038"/><polygon fill="#A80036" points="2182,2579.4038,2186,2589.4038,2190,2579.4038,2186,2583.4038" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2186" x2="2186" y1="2837.959" y2="2857.959"/><polygon fill="#A80036" points="2182,2847.959,2186,2857.959,2190,2847.959,2186,2851.959" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2186" x2="2186" y1="2693.2163" y2="2748.1152"/><polygon fill="#A80036" points="2182,2738.1152,2186,2748.1152,2190,2738.1152,2186,2742.1152" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2786.5" x2="2786.5" y1="3003.8027" y2="3028.2051"/><polygon fill="#A80036" points="2782.5,3018.2051,2786.5,3028.2051,2790.5,3018.2051,2786.5,3022.2051" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2850.5" x2="2914.5" y1="2991.8027" y2="2991.8027"/><polygon fill="#A80036" points="2910.5,3042.1738,2914.5,3052.1738,2918.5,3042.1738,2914.5,3046.1738" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2914.5" x2="2914.5" y1="2991.8027" y2="3108.1426"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2914.5" x2="2798.5" y1="3108.1426" y2="3108.1426"/><polygon fill="#A80036" points="2808.5,3104.1426,2798.5,3108.1426,2808.5,3112.1426,2804.5,3108.1426" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2786.5" x2="2786.5" y1="3076.1426" y2="3096.1426"/><polygon fill="#A80036" points="2782.5,3086.1426,2786.5,3096.1426,2790.5,3086.1426,2786.5,3090.1426" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2786.5" x2="2786.5" y1="3164.1426" y2="3188.5449"/><polygon fill="#A80036" points="2782.5,3178.5449,2786.5,3188.5449,2790.5,3178.5449,2786.5,3182.5449" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2876" x2="2907.5" y1="3152.1426" y2="3152.1426"/><polygon fill="#A80036" points="2903.5,3202.5137,2907.5,3212.5137,2911.5,3202.5137,2907.5,3206.5137" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2907.5" x2="2907.5" y1="3152.1426" y2="3268.4824"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2907.5" x2="2798.5" y1="3268.4824" y2="3268.4824"/><polygon fill="#A80036" points="2808.5,3264.4824,2798.5,3268.4824,2808.5,3272.4824,2804.5,3268.4824" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2786.5" x2="2786.5" y1="3236.4824" y2="3256.4824"/><polygon fill="#A80036" points="2782.5,3246.4824,2786.5,3256.4824,2790.5,3246.4824,2786.5,3250.4824" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2786.5" x2="2786.5" y1="3120.1426" y2="3140.1426"/><polygon fill="#A80036" points="2782.5,3130.1426,2786.5,3140.1426,2790.5,3130.1426,2786.5,3134.1426" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2786.5" x2="2786.5" y1="3324.4824" y2="3348.8848"/><polygon fill="#A80036" points="2782.5,3338.8848,2786.5,3348.8848,2790.5,3338.8848,2786.5,3342.8848" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2848" x2="2910" y1="3312.4824" y2="3312.4824"/><polygon fill="#A80036" points="2906,3362.8535,2910,3372.8535,2914,3362.8535,2910,3366.8535" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2910" x2="2910" y1="3312.4824" y2="3428.8223"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2910" x2="2798.5" y1="3428.8223" y2="3428.8223"/><polygon fill="#A80036" points="2808.5,3424.8223,2798.5,3428.8223,2808.5,3432.8223,2804.5,3428.8223" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2786.5" x2="2786.5" y1="3396.8223" y2="3416.8223"/><polygon fill="#A80036" points="2782.5,3406.8223,2786.5,3416.8223,2790.5,3406.8223,2786.5,3410.8223" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2786.5" x2="2786.5" y1="3280.4824" y2="3300.4824"/><polygon fill="#A80036" points="2782.5,3290.4824,2786.5,3300.4824,2790.5,3290.4824,2786.5,3294.4824" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2786.5" x2="2786.5" y1="3440.8223" y2="3460.8223"/><polygon fill="#A80036" points="2782.5,3450.8223,2786.5,3460.8223,2790.5,3450.8223,2786.5,3454.8223" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2786.5" x2="2786.5" y1="3508.7598" y2="3528.7598"/><polygon fill="#A80036" points="2782.5,3518.7598,2786.5,3528.7598,2790.5,3518.7598,2786.5,3522.7598" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="3093.5" x2="3093.5" y1="3684.5723" y2="3704.5723"/><polygon fill="#A80036" points="3089.5,3694.5723,3093.5,3704.5723,3097.5,3694.5723,3093.5,3698.5723" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="3093.5" x2="3093.5" y1="3752.5098" y2="3772.5098"/><polygon fill="#A80036" points="3089.5,3762.5098,3093.5,3772.5098,3097.5,3762.5098,3093.5,3766.5098" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="177" x2="177" y1="826.8989" y2="831.8989"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="177" x2="675.5" y1="831.8989" y2="831.8989"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="675.5" x2="675.5" y1="831.8989" y2="846.8989"/><polygon fill="#A80036" points="671.5,836.8989,675.5,846.8989,679.5,836.8989,675.5,840.8989" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="675.5" x2="675.5" y1="1350.5708" y2="1359.5674"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="675.5" x2="1498" y1="1359.5674" y2="1359.5674"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1498" x2="1498" y1="1359.5674" y2="1393.4697"/><polygon fill="#A80036" points="1494,1383.4697,1498,1393.4697,1502,1383.4697,1498,1387.4697" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1498" x2="1498" y1="2326.8174" y2="2335.814"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1498" x2="2186" y1="2335.814" y2="2335.814"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2186" x2="2186" y1="2335.814" y2="2369.7163"/><polygon fill="#A80036" points="2182,2359.7163,2186,2369.7163,2190,2359.7163,2186,2363.7163" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2186" x2="2186" y1="2947.8027" y2="2964.8027"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2186" x2="2786.5" y1="2964.8027" y2="2964.8027"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2786.5" x2="2786.5" y1="2964.8027" y2="2979.8027"/><polygon fill="#A80036" points="2782.5,2969.8027,2786.5,2979.8027,2790.5,2969.8027,2786.5,2973.8027" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2786.5" x2="2786.5" y1="3604.6348" y2="3621.6348"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2786.5" x2="3093.5" y1="3621.6348" y2="3621.6348"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="3093.5" x2="3093.5" y1="3621.6348" y2="3636.6348"/><polygon fill="#A80036" points="3089.5,3626.6348,3093.5,3636.6348,3097.5,3626.6348,3093.5,3630.6348" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="305" x="24" y="39.9297">Step 1: Detection (run_extraction.py → GlobalPipeline)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="393" x="478.5" y="39.9297">Step 2: Preprocessing (run_preprocessing.py → PatchPreprocessing)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="419" x="1141.5" y="39.9297">Step 3: Clustering Sweep (sweep_clustering.py → graphClusteringSweep)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="157" x="1947" y="39.9297">Step 4: Refinement Pipeline</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="132" x="2560" y="39.9297">Step 5: Post-Clustering</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="38" x="3074" y="39.9297">Output</text><line style="stroke: #000000; stroke-width: 2.0;" x1="10" x2="10" y1="29.7192" y2="3794.5098"/><line style="stroke: #000000; stroke-width: 2.0;" x1="343" x2="343" y1="29.7192" y2="3794.5098"/><line style="stroke: #000000; stroke-width: 2.0;" x1="1007" x2="1007" y1="29.7192" y2="3794.5098"/><line style="stroke: #000000; stroke-width: 2.0;" x1="1695" x2="1695" y1="29.7192" y2="3794.5098"/><line style="stroke: #000000; stroke-width: 2.0;" x1="2356" x2="2356" y1="29.7192" y2="3794.5098"/><line style="stroke: #000000; stroke-width: 2.0;" x1="2939.5" x2="2939.5" y1="29.7192" y2="3794.5098"/><line style="stroke: #000000; stroke-width: 2.0;" x1="3246.5" x2="3246.5" y1="29.7192" y2="3794.5098"/><rect fill="#DDDDDD" height="138.0469" rx="5" ry="5" style="stroke: #000000; stroke-width: 1.0;" width="622" x="1316.75" y="3802.5098"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="520" x="1322.75" y="3817.7202">Registration Sub-Pipeline (used by HausdorffSplit, PCAZScore, MST, Congealing):</text><text fill="#000000" font-family="monospace" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="140" x="1322.75" y="3830.5249">InverseCompositional</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="318" x="1466.75" y="3830.5249">→ single-scale Gauss-Newton with robust error function</text><text fill="#000000" font-family="monospace" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="105" x="1322.75" y="3843.3296">GaussianPyramid</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="165" x="1431.75" y="3843.3296">→ coarse-to-fine image stack</text><text fill="#000000" font-family="monospace" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="84" x="1322.75" y="3856.1343">MultiscaleIC</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="174" x="1410.75" y="3856.1343">→ coarse→fine IC alignment  →</text><text fill="#000000" font-family="monospace" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="105" x="1588.75" y="3856.1343">PlanarTransform</text><text fill="#000000" font-family="monospace" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="154" x="1322.75" y="3868.939">PlanarTransform.warp()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="245" x="1480.75" y="3868.939">→ bicubic grid sampling with visibility mask</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="1326.75" y="3881.7437"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="386" x="1322.75" y="3894.5483">Deformation-Invariant Features (alternative to registration):</text><text fill="#000000" font-family="monospace" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="154" x="1322.75" y="3907.353">ShapeContextDescriptor</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="360" x="1480.75" y="3907.353">→ contour sampling → log-polar histograms → chi² + Hungarian</text><text fill="#000000" font-family="monospace" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="196" x="1322.75" y="3920.1577">PersistentHomologyDescriptor</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="410" x="1522.75" y="3920.1577">→ distance transform → cubical complex (gudhi) → H0/H1 → Wasserstein</text><text fill="#000000" font-family="monospace" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="140" x="1322.75" y="3932.9624">TopologicalPreFilter</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="235" x="1466.75" y="3932.9624">→ (n_components, n_loops) fast rejection</text><!--MD5=[fab0ded90918a8d7935f1ea0f633ca76]
@startuml Pipeline Activity Diagram
skinparam defaultFontSize 11
skinparam activityFontSize 12
skinparam titleFontSize 16
skinparam shadowing false

title A Contrario Character Clustering — Pipeline Activity Diagram

|#E8F5E9| Step 1: Detection (run_extraction.py → GlobalPipeline) |
start
:Load document image (PIL);
:CRAFT neural network inference
(score_text, score_link);
:Watershed segmentation on score map
(dual-threshold: seed + basin);
:Filter CRAFT components
(area, aspect ratio);
:Merge nearby CRAFT components
(link score proximity);
:Binarize page image
(Otsu / Li / triangle);
:Extract image connected components;
:Filter by aspect ratio & major axis;
:Compute Mahalanobis similarity
(CRAFT centroids ↔ image centroids);
:Hungarian matching: assign image
components to CRAFT detections;
:Filter by contour proximity,
aspect ratio, filled area, min area;
:Save connectedComponent .npz files;

|#E3F2FD| Step 2: Preprocessing (run_preprocessing.py → PatchPreprocessing) |
:Load connectedComponent from .npz;

fork
  :CPU Stage;
  :Extract binary & grayscale patches;
  :Apply ink filter (background removal);
  :Vectorize binary patches → SVG
  (external C++ → BinaryShapeVectorizer);
  :Deskew SVGs (page orientation → rotation);
fork again
  :GPU Stage;
  :CHAT OCR per subcolumn
  (Kraken rpred → spatial Hungarian matching
   → char_chat / conf_chat);
  :Compute HOG descriptors
  (Renderer → DataLoader → HOG convolutions
   → trilinear binning → histograms);
end fork

:Produce DataFrame:
  page, file, label, centroid,
  svg, histogram, char_chat, conf_chat;

|#FFF3E0| Step 3: Clustering Sweep (sweep_clustering.py → graphClusteringSweep) |

partition "3a. HOG Config Sweep" {
  :Generate HOG configs:
  cell_sizes × grdt_sigmas × num_bins × normalizations;

  while (for each HOG config) is (next config)
    :Instantiate Renderer(svg_imgs)
    → DataLoader → HOG(batch)
    → histogram features;

    :featureMatching.match(features, features)
    → NLFA matrix, dissimilarities, μ, σ²;

    partition "3b. ε × γ Grid Search" {
      while (for each ε) is (next ε)
        :Build NX graph from NLFA
        (threshold + reciprocal edges);
        while (for each γ) is (next γ)
          :Leiden partition
          (RBConfigurationVertexPartition);
          :Evaluate ARI against ground truth;
        endwhile
      endwhile
    }

    :Track best (config, ε, γ, ARI);
  endwhile
}

:Select best overall HOG config;

partition "3c. report_graph (best config)" {
  :Build final graph + Leiden partition
  with best (ε, γ);

  :Compute degree centrality;

  |#FFEBEE| Step 4: Refinement Pipeline |

  partition "4a. Composable Refinement Steps" {
    note
      Each step: run(df, membership, renderer,
                     target_lbl=..., **ctx)
      → RefinementResult(membership, log, metadata)
      Output feeds next step.
    end note

    :① HausdorffSplitStep
    ── Per-cluster IC registration ──
    ── Pairwise Hausdorff distances ──
    ── Hierarchical linkage + fcluster ──
    ── Sweep split thresholds → best ARI ──
    ── Unknown patches → largest subcluster;

    :② OCRRematchStep
    ── Small clusters (≤ max_size) ──
    ── Match dominant OCR label ──
    ── Merge into largest same-label cluster;

    :③ PCAZScoreRematchStep
    ── Remaining small clusters ──
    ── k-NN candidates by mean HOG ──
    ── Register query → target anchor ──
    ── PCA projection + z-score test ──
    ── Merge if max|z| < z_max;
  }

  partition "4b. New Refinement Methods" {
    :④ MRFRefinementStep (optional)
    ── Unary: OCR probability matrix ──
    ── Pairwise: β · NLFA (Potts) ──
    ── Max-sum loopy BP ──
    ── Damped convergence;

    :⑤ KMedoidsSplitMergeStep (optional)
    ── Reassign to nearest medoid ──
    ── Spectral split (Fiedler vector) ──
    ── NFA-validated merge ──
    ── Iterate until stable;
  }

  |#FFF3E0| Step 5: Post-Clustering |
  if (enable_chat_split?) then (yes)
    :chat_split_clusters
    Split impure clusters by CHAT label;
  endif

  if (enable_hapax_association?) then (yes)
    :associate_hapax
    Merge singletons by dissimilarity;
  endif

  if (enable_glossary?) then (yes)
    :build_glossary
    Character inventory by frequency;
  endif

  :Compute purity, completeness,
  cluster entropy, label entropy;

  :Compute final metrics:
  ARI, NMI, AMI, FMI, V-measure,
  homogeneity, completeness,
  pairwise F1, Hungarian accuracy;
}

|#FFF9C4| Output |
:Generate HTML report
(ClusteringSweepReporter → AutoReport);

:Return: (dataframe, filtered_df,
          representatives_df, graph, partition);

stop


legend bottom
  **Registration Sub-Pipeline (used by HausdorffSplit, PCAZScore, MST, Congealing):**
  ""InverseCompositional"" → single-scale Gauss-Newton with robust error function
  ""GaussianPyramid"" → coarse-to-fine image stack
  ""MultiscaleIC"" → coarse→fine IC alignment  → ""PlanarTransform""
  ""PlanarTransform.warp()"" → bicubic grid sampling with visibility mask

  **Deformation-Invariant Features (alternative to registration):**
  ""ShapeContextDescriptor"" → contour sampling → log-polar histograms → chi² + Hungarian
  ""PersistentHomologyDescriptor"" → distance transform → cubical complex (gudhi) → H0/H1 → Wasserstein
  ""TopologicalPreFilter"" → (n_components, n_loops) fast rejection
endlegend

@enduml

PlantUML version 1.2020.02(Sun Mar 01 10:22:07 UTC 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 21.0.10+7-Ubuntu-124.04
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>